<%- include('partials/header') %>

<%- include('partials/Loader') %>


<div class="max-w-4xl mx-auto mt-10 bg-white p-6 rounded-lg shadow-md">
  <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">ðŸ›’ Your Cart</h2>

  <% if (cartItems.length === 0) { %>
    <%- include('partials/EmptyState') %>
  <% } else { %>
    <% var total = 0; %>
    <% cartItems.forEach(function(item) { %>
      <% 
        var discountedPrice = item.product.price - (item.product.price * item.product.discount / 100);
        total += discountedPrice * item.quantity;
      %>

      <div class="flex items-center mb-4 border-b pb-4">
        <img src="<%= item.product.image %>" alt="Product Image" class="w-24 h-24 object-cover rounded" />
        
        <div class="ml-4 flex-1">
          <h3 class="text-lg font-semibold"><%= item.product.name %></h3>
          <p class="text-sm text-gray-600">Price: â‚¹<%= discountedPrice %></p>

          <form action="/cart/update/<%= item.product._id %>" method="POST" class="inline">
            <input type="number" name="quantity" value="<%= item.quantity %>" min="1"
                class="w-16 px-2 py-1 border rounded"
                onchange="this.form.submit()">
          </form>
        </div>

        <form action="/cart/remove/<%= item.product._id %>" method="POST">
          <button class="text-red-500 hover:text-red-700 ml-4">Remove</button>
        </form>
      </div>
    <% }) %>

    <div class="text-right mt-6">
      <p class="text-lg font-semibold">Subtotal: â‚¹<%= total %></p>
      <p class="text-lg font-semibold">Delivery: â‚¹50</p>
      <p class="text-xl font-bold mt-2">Total: â‚¹<%= total + 50 %></p>
    </div>

    <form action="/payment" method="GET" class="text-center mt-6">
      <button class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">Proceed to Buy</button>
    </form>
  <% } %>
</div>

<%- include('partials/footer') %>



